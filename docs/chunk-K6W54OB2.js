import{a as Q,b as g,c as X,i as Y,j as E,p as F,q as Z,r as ee,t as te,u as P,v as ie}from"./chunk-OF5W7DEF.js";import"./chunk-LIADLQQ4.js";import{l as z,n as J}from"./chunk-MDDKJWGL.js";import"./chunk-HZTNMKQF.js";import{Da as a,Db as c,Eb as k,Gb as q,Hb as L,Ib as H,Jb as G,Qa as y,Qb as W,S as $,Va as b,Wb as N,Y as u,bb as T,ca as _,da as f,fb as A,hb as v,jb as V,kb as j,lb as r,ma as I,mb as s,nb as B,pa as h,rb as w,sb as p,tb as d,ub as K,vb as U}from"./chunk-HDX5X56L.js";var O="update-sshkey/";var R="generate-token/";var oe=(()=>{class t{has(e){return!0}get(e){return null}set(e,o){}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275prov=$({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var ae=["*"],re=(()=>{class t{constructor(){this.choice=I()}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275cmp=y({type:t,selectors:[["app-dialog-box"]],outputs:{choice:"choice"},ngContentSelectors:ae,decls:8,vars:0,consts:[[1,"container"],[1,"btn-row"],[1,"link",3,"click"],[1,"btn","btn-red",3,"click"]],template:function(o,n){o&1&&(K(),r(0,"div",0)(1,"div"),U(2),r(3,"div",1)(4,"div",2),p("click",function(){return n.choice.emit("confirm")}),c(5,"Confirm "),s(),r(6,"div",3),p("click",function(){return n.choice.emit("cancel")}),c(7,"Cancel "),s()()()())},styles:[".container[_ngcontent-%COMP%]{z-index:10;background:#fff;padding:1em;max-width:32rem;position:absolute;top:50%;left:50%;margin-right:-50%;transform:translate(-50%,-50%)}.container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{border:1px solid rgb(188.7765,193.0248,196.2735);border-radius:.375em;padding:1em}.container[_ngcontent-%COMP%]   .btn-row[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:baseline;gap:1em}"]})}}return t})();var ce=(t,i)=>i.property;function le(t,i){if(t&1){let e=w();r(0,"app-dialog-box",3),p("choice",function(n){_(e);let l=d();return f(l.choice(n))}),r(1,"p"),c(2,"Deleting account would remove all stored information"),s(),r(3,"p"),c(4,"Are you sure you want to continue?"),s()()}}function de(t,i){if(t&1&&(r(0,"td"),c(1),s()),t&2){let e=d().$implicit;a(),k(e.value)}}function pe(t,i){if(t&1){let e=w();r(0,"td")(1,"app-form",4),H("submittedChange",function(n){_(e);let l=d().$implicit;return L(l.submitted,n)||(l.submitted=n),f(n)}),p("submittedChange",function(){_(e);let n=d().$implicit;return f(n.onSubmit())}),s()()}if(t&2){let e=d().$implicit;a(),T("fields",e.fields)("formDesc",e.formDes),q("submitted",e.submitted)}}function me(t,i){if(t&1&&(r(0,"p"),c(1),s()),t&2){let e=d(2).$implicit;a(),k(e.value())}}function ue(t,i){if(t&1){let e=w();r(0,"td"),b(1,me,2,1,"p"),r(2,"app-button",5),p("click",function(){_(e);let n=d().$implicit;return f(n.onClick())}),s()()}if(t&2){let e=d().$implicit;a(),v(e.value()?1:-1),a(),T("button",e.button)("busy",e.submitted())}}function he(t,i){if(t&1&&(r(0,"tr")(1,"td"),c(2),s(),b(3,de,2,1,"td")(4,pe,2,3,"td")(5,ue,3,3,"td"),s()),t&2){let e=i.$implicit;a(2),k(e.property),a(),v(e.isText()?3:e.isForm()?4:e.isAction()?5:-1)}}function _e(t,i){if(t&1&&(r(0,"table")(1,"thead")(2,"tr")(3,"th"),c(4,"Property"),s(),r(5,"th"),c(6,"Value"),s()()(),r(7,"tbody"),V(8,he,6,2,"tr",null,ce),s()()),t&2){let e=d();a(8),j(e.rows())}}function fe(t,i){t&1&&B(0,"img",2)}var D=class{constructor(i){Object.assign(this,i)}isText(){return this instanceof m}isAction(){return this instanceof C}isForm(){return this instanceof x}},m=class extends D{constructor(i){super(i)}},S=class extends D{constructor(i){i.path=`${P}${i.path}`,super(i),this.submitted=h(!1);let e=i.name.toLowerCase().split(" ").join("-");e=`btn-${e}`,this.button={label:i.name,classes:"primary small",id:e}}_error(i){alert(`Something went wrong ${i}`)}_next(i){return i.status==="login_required"?(this.services.router.navigate(["../login"],{relativeTo:this.services.route}),!1):!0}get(){this.services.backend.get(this.path).subscribe({error:this._error,next:i=>{this._next(i)&&this.next(i)}})}},C=class extends S{constructor(i){super(i),this.value=h(void 0)}onClick(){this.value()||(this.submitted.set(!0),this.get())}next(i){this.value.set(i[this.valueKey]),this.submitted.set(!1)}},x=class extends S{constructor(i){super(i),this.formDes=new Z({class:"inline",button:this.button})}post(i){this.services.backend.post(this.path,i).subscribe({error:this._error,next:e=>{this._next(e)&&this.next(e)}})}onSubmit(){let i=this.submitted();this.post(i)}next(i){this.services.cd.detectChanges(),this.submitted.set(!1)}},M;Q.production?M={provide:g,useClass:g}:M={provide:g,useClass:oe};var je=(()=>{class t{constructor(){this.initDone=h(!1),this.rows=h([]),this.showAlert=h(!1),this.containerClass=N(()=>this.showAlert()?{flex:!0,disabled:!0}:{flex:!0,disabled:!1});let e=u(X),o=u(W),n=u(g),l=u(z),se=u(J);this.services={backend:e,cd:o,cookie:n,router:se,route:l}}ngOnInit(){this.services.cookie.has("csrftoken")?this.services.backend.get(P).subscribe({next:e=>{e.status===ie.LOGIN_REQUIRED?this.services.router.navigate(["../login"],{relativeTo:this.services.route}):(this.dashboardResponse=e,this.initTable(),this.initDone.set(!0))},error:e=>{this.services.router.navigate(["../login"],{relativeTo:this.services.route})}}):this.services.router.navigate(["../login"],{relativeTo:this.services.route})}initTable(){let e=this.dashboardResponse.username||"",o=this.dashboardResponse.sshPort?`ssh ${e}@api.djongomapper.com -p ${this.dashboardResponse.sshPort}`:"Upload SSH Key",n=[new F({key:"sshField",label:"New SSH key",attr:new E({name:"ssh-key",required:!0}),errors:{other:"Oops something went wrong. We are working to fix this. Please contact: support@doableware.com"}})],l=[new F({key:"message",label:"Message",attr:new E({name:"message",required:!0})})];this.rows.set([new m({property:"Username",value:e}),new m({property:"Base URL",value:`https://api.djongomapper.com/${e}`}),new m({property:"Status",value:this.dashboardResponse.state||""}),new m({property:"SSH Command",value:o}),new x({property:"SSH Public Key",services:this.services,path:O,name:"Update Key",fields:n}),new C({property:"PyPi Access Token",services:this.services,name:"Generate Token",path:R,valueKey:"token"}),new x({property:"Support Request",services:this.services,path:O,name:"Send",fields:l}),new C({property:"Delete Account",services:this.services,name:"Delete",path:R,valueKey:"token"})])}choice(e){e=="confirm",this.showAlert.set(!1)}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275cmp=y({type:t,selectors:[["app-dashboard"]],features:[G([M])],decls:6,vars:4,consts:[["role","main",1,"page-fixed"],[1,"page-content"],["src","/assets/images/spinner.svg","alt","Button is busy",2,"height","100px","margin","calc(50% - 50px) auto"],[3,"choice"],[3,"submittedChange","fields","formDesc","submitted"],[3,"click","button","busy"]],template:function(o,n){o&1&&(r(0,"main",0)(1,"div",1),b(2,le,5,0,"app-dialog-box"),r(3,"div"),b(4,_e,10,0,"table")(5,fe,1,0,"img",2),s()()()),o&2&&(a(2),v(n.showAlert()?2:-1),a(),A(n.containerClass()),a(),v(n.initDone()?4:5))},dependencies:[te,ee,Y,re],styles:["td[_ngcontent-%COMP%]:first-child, th[_ngcontent-%COMP%]:first-child{padding-left:1em}table[_ngcontent-%COMP%]{margin:3em auto 1em;display:table}#center[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;margin-right:-50%;transform:translate(-50%,-50%)}div.disabled[_ngcontent-%COMP%]{pointer-events:none;opacity:.7}"]})}}return t})();export{je as DashboardComponent};
