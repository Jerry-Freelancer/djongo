<!DOCTYPE html><html lang="en" class="no-js" data-beasties-container><head>
  <meta charset="UTF-8">
  <title>Creating Capped Models using MongoDB</title>
  <meta name="description" content="Djongo is a smarter approach to database querying. It maps python objects to MongoDB documents. It is popularly referred to as an Object Document Mapper or ODM. It is an extension to the traditional Django object relational modeling framework. Use Django Admin to directly add and modify documents stored in MongoDB. Use other contrib modules such as Auth and Sessions without any changes.">
  <meta property="og:type" content="website">
  <meta property="og:locale" content="en_US">
  <meta property="og:site_name" content="Djongomapper">
  <meta property="og:title" content="Djongo">
  <meta property="og:url" content="https://www.djongomapper.com/">
  <meta property="og:description" content="Djongo is a smarter approach to database querying. It maps python objects to MongoDB documents. It is popularly referred to as an Object Document Mapper or ODM. It is an extension to the traditional Django object relational modeling framework. Use Django Admin to directly add and modify documents stored in MongoDB. Use other contrib modules such as Auth and Sessions without any changes.">
  <link rel="canonical" href="https://www.djongomapper.com/">
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Doableware",
      "url": "https://www.djongomapper.com/",
      "logo": "/assets/images/djongo-symbol-small.png"
    }
  </script>
  <meta name="google-site-verification" content="tFNu7Nc9hzKF9v7f6kYaoMbBCNyGREchcKMVdxJuyJo">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">
  </noscript>
  <link rel="stylesheet" type="text/css" media="screen" href="/assets/css/custom.css">
  <link rel="shortcut icon" href="/assets/images/favicon.ico">
  <script>
    if (window.location.hostname != 'localhost') {
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
                    'gtm.start':
                      new Date().getTime(), event: 'gtm.js'
                  });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : '';
        j.async = true;
        j.src =
          'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, 'script', 'dataLayer', 'GTM-T72KG6N');
    }
  </script>
  <base href="/">
<link rel="stylesheet" href="styles-3L6BFFQQ.css" media="print" onload="this.media='all'"><noscript><link rel="stylesheet" href="styles-3L6BFFQQ.css"></noscript><style ng-app-id="ng">.body[_ngcontent-ng-c2949683947]{display:grid;grid-template-columns:minmax(max-content,calc(16rem - 1em)) minmax(16rem,80rem) minmax(min-content,calc(16rem - 1em));grid-template-rows:repeat(2,auto);justify-content:center;column-gap:1em;padding-left:1em;padding-right:1em}.page-content[_ngcontent-ng-c2949683947]{grid-row:1/-1}.aside-left[_ngcontent-ng-c2949683947], .aside-right[_ngcontent-ng-c2949683947]{grid-row:1}@media (max-width: 80rem){.body[_ngcontent-ng-c2949683947]{grid-template-columns:max-content minmax(24rem,80rem);grid-template-rows:repeat(3,auto)}.aside-left[_ngcontent-ng-c2949683947]{grid-column:1;grid-row:1/3}.page-content[_ngcontent-ng-c2949683947]{grid-column:2;grid-row:2/-1}.aside-right[_ngcontent-ng-c2949683947]{grid-column:2;grid-row:1/2}}@media (max-width: 48rem){.body[_ngcontent-ng-c2949683947]{grid-template-rows:repeat(2,auto)}.aside-left[_ngcontent-ng-c2949683947]{grid-row:1/-1}.aside-right[_ngcontent-ng-c2949683947]{grid-row:1}.page-content[_ngcontent-ng-c2949683947]{grid-row:2}}.nav[_ngcontent-ng-c2949683947]{padding-top:1em;padding-bottom:1em;min-width:min-content;max-width:max-content;font-size:var(--font-sm)}@media (max-width: 80rem){.nav[_ngcontent-ng-c2949683947]{font-size:var(--font-base)}}.nav[_ngcontent-ng-c2949683947]   a[_ngcontent-ng-c2949683947]{text-decoration:none}.nav-sticky[_ngcontent-ng-c2949683947]{position:sticky;top:3em;overflow:auto;max-height:calc(100vh - 3em)}.nav-sticky.aside-left[_ngcontent-ng-c2949683947]{z-index:1}@media (max-width: 80rem){.nav-sticky.aside-right[_ngcontent-ng-c2949683947]{position:static;max-height:inherit}}.nav-side[_ngcontent-ng-c2949683947]{line-height:1.58}.nav-side[_ngcontent-ng-c2949683947]   h3[_ngcontent-ng-c2949683947]{font-size:1em;opacity:.7;text-transform:uppercase;border-bottom:1px solid rgb(241.7553,242.60496,243.2547);margin:.5em 0;padding:.25em 0}.nav-side[_ngcontent-ng-c2949683947]   a[_ngcontent-ng-c2949683947]{color:inherit;opacity:.7}.nav-side[_ngcontent-ng-c2949683947]   .active[_ngcontent-ng-c2949683947]{font-weight:700;opacity:1}.nav-side[_ngcontent-ng-c2949683947]   a[_ngcontent-ng-c2949683947]:hover{opacity:1}.nav-toc[_ngcontent-ng-c2949683947]   h3[_ngcontent-ng-c2949683947]{font-size:var(--font-base);font-weight:700;color:#fff;background:#62696e;border-top-left-radius:.375em;border-top-right-radius:.375em;padding:var(--space-2xs) var(--space-xs);margin:0}.nav-toc[_ngcontent-ng-c2949683947]   a[_ngcontent-ng-c2949683947]{display:block;padding:var(--space-2xs) var(--space-xs);color:#646769;font-weight:700;line-height:1.5;border-bottom:1px solid rgb(241.7553,242.60496,243.2547);border-left:1px solid rgb(241.7553,242.60496,243.2547);border-right:1px solid rgb(241.7553,242.60496,243.2547)}.nav-toc[_ngcontent-ng-c2949683947]   a[_ngcontent-ng-c2949683947]:hover{text-decoration:underline}.nav-toc[_ngcontent-ng-c2949683947]   li[_ngcontent-ng-c2949683947]   li[_ngcontent-ng-c2949683947] > a[_ngcontent-ng-c2949683947]{font-weight:400;padding-left:1em}.nav-toc[_ngcontent-ng-c2949683947]   .active[_ngcontent-ng-c2949683947]{background-color:#e2e4e5}.sidebar[_ngcontent-ng-c2949683947]{opacity:1}.sidebar[_ngcontent-ng-c2949683947]   li[_ngcontent-ng-c2949683947]{font-size:.7em}.page-content[_ngcontent-ng-c2949683947]{margin-top:1em}</style><style ng-app-id="ng">.cookie-notice[_ngcontent-ng-c3463078263]{height:0}.open[_ngcontent-ng-c3463078263]{height:auto}.close[_ngcontent-ng-c3463078263]{height:0;transition:height .3s ease-out}.mast[_ngcontent-ng-c3463078263]{position:sticky;top:0;padding:.5em 0;z-index:10;background:#fff;border-bottom:1px solid rgb(241.7553,242.60496,243.2547)}@media (max-width: 90rem){.mast[_ngcontent-ng-c3463078263]{padding:.5em 1em}}.mast[_ngcontent-ng-c3463078263] > div[_ngcontent-ng-c3463078263]{margin:0 auto;max-width:80rem;display:flex;flex-direction:row;justify-content:space-between}.mast[_ngcontent-ng-c3463078263]   a[_ngcontent-ng-c3463078263]{display:block;color:#62696e;text-decoration:none}.mast[_ngcontent-ng-c3463078263]   .mast-logo[_ngcontent-ng-c3463078263]{display:flex;gap:.7rem;align-items:center}.mast[_ngcontent-ng-c3463078263]   .mast-logo[_ngcontent-ng-c3463078263]   img[_ngcontent-ng-c3463078263]{max-height:2em}.mast[_ngcontent-ng-c3463078263]   .mast-nav[_ngcontent-ng-c3463078263]   ul[_ngcontent-ng-c3463078263]{display:flex;align-items:center;gap:1.3rem}.mast[_ngcontent-ng-c3463078263]   .mast-nav[_ngcontent-ng-c3463078263]   ul.media-small[_ngcontent-ng-c3463078263]{padding-top:1rem;padding-bottom:1rem;flex-direction:column;align-items:start;gap:.3rem}.mast[_ngcontent-ng-c3463078263]   .mast-nav[_ngcontent-ng-c3463078263]   .nav-link[_ngcontent-ng-c3463078263]{position:relative}.mast[_ngcontent-ng-c3463078263]   .mast-nav[_ngcontent-ng-c3463078263]   .nav-link[_ngcontent-ng-c3463078263]:hover:after{width:100%}.mast[_ngcontent-ng-c3463078263]   .mast-nav[_ngcontent-ng-c3463078263]   .nav-link[_ngcontent-ng-c3463078263]:after{content:"";position:absolute;left:50%;bottom:0;transform:translate(-50%);width:0;height:4px;background-color:#62696e;transition:width .2s ease-in-out}.mast[_ngcontent-ng-c3463078263]   .mast-nav[_ngcontent-ng-c3463078263]   .btn-nav[_ngcontent-ng-c3463078263]{padding:.5em 1em;font-size:var(--font-sm);font-weight:700;text-align:center;border-width:0;border-radius:.1875em;color:#fff}.burger[_ngcontent-ng-c3463078263]{display:flex;flex-direction:column;gap:4px}.burger[_ngcontent-ng-c3463078263] > div[_ngcontent-ng-c3463078263]{height:4px;width:1.5rem;background-color:#62696e;border-radius:4px}.burger[_ngcontent-ng-c3463078263]:hover{cursor:pointer}</style><style ng-app-id="ng">.media-small[_ngcontent-ng-c40719357]{position:fixed;top:3rem;left:0;padding:0 1rem;background:#fff;height:100vh;border-right:1px solid rgb(241.7553,242.60496,243.2547);z-index:1}.cross[_ngcontent-ng-c40719357]{margin:.5rem 0;aspect-ratio:1;width:1.2rem}.cross[_ngcontent-ng-c40719357]:hover{cursor:pointer}.cross[_ngcontent-ng-c40719357] > div[_ngcontent-ng-c40719357]{background:#000;height:1px;width:1.2rem}.cross[_ngcontent-ng-c40719357] > div[_ngcontent-ng-c40719357]:nth-child(1){transform:translateY(.6rem) rotate(-45deg)}.cross[_ngcontent-ng-c40719357] > div[_ngcontent-ng-c40719357]:nth-child(2){transform:translateY(calc(.6rem - 1px)) rotate(45deg)}.open[_ngcontent-ng-c40719357]{transition:transform .4s ease-in;transform:translate(0)}.close[_ngcontent-ng-c40719357]{transform:translate(-100%);padding:0;overflow:hidden;transition:transform .3s ease-out}</style></head>
<body><!--nghm--><script type="text/javascript" id="ng-event-dispatch-contract">(()=>{function p(t,n,r,o,e,i,f,m){return{eventType:t,event:n,targetElement:r,eic:o,timeStamp:e,eia:i,eirp:f,eiack:m}}function u(t){let n=[],r=e=>{n.push(e)};return{c:t,q:n,et:[],etc:[],d:r,h:e=>{r(p(e.type,e,e.target,t,Date.now()))}}}function s(t,n,r){for(let o=0;o<n.length;o++){let e=n[o];(r?t.etc:t.et).push(e),t.c.addEventListener(e,t.h,r)}}function c(t,n,r,o,e=window){let i=u(t);e._ejsas||(e._ejsas={}),e._ejsas[n]=i,s(i,r),s(i,o,!0)}window.__jsaction_bootstrap=c;})();
</script><script>window.__jsaction_bootstrap(document.body,"ng",["click"],[]);</script>
<app-root ng-version="19.2.0" ngh="4" ng-server-context="ssg"><router-outlet></router-outlet><ng-component _nghost-ng-c2949683947 ngh="3"><app-body _ngcontent-ng-c2949683947 _nghost-ng-c3463078263 ngh="1"><div _ngcontent-ng-c3463078263 class="page-splash"><div _ngcontent-ng-c3463078263 class="mast"><div _ngcontent-ng-c3463078263><div _ngcontent-ng-c3463078263 class="mast-logo"><a _ngcontent-ng-c3463078263 href="/"><img _ngcontent-ng-c3463078263 src="/assets/images/djongo-symbol-small.png" alt="Djongo"></a><!----></div><div _ngcontent-ng-c3463078263 class="mast-nav"><app-nav _ngcontent-ng-c3463078263 _nghost-ng-c40719357 ngh="0"><!----><!----><!----></app-nav></div></div></div><div _ngcontent-ng-c3463078263 class="initial-content"><div _ngcontent-ng-c2949683947 class="body"><aside _ngcontent-ng-c2949683947 class="nav-sticky aside-left"><app-nav _ngcontent-ng-c2949683947 _nghost-ng-c40719357 ngh="0"><!----><!----><!----></app-nav></aside><div _ngcontent-ng-c2949683947 class="page-content"><header _ngcontent-ng-c2949683947><h1 _ngcontent-ng-c2949683947 class="title-docs">Creating Capped Models using MongoDB</h1></header><router-outlet _ngcontent-ng-c2949683947></router-outlet><ng-component ngh="2"><p>[Capped collections][capped] are fixed-size collections that support high-throughput operations that insert and retrieve documents based on insertion order. Capped collections work in a way similar to circular buffers: once a collection fills its allocated space, it makes room for new documents by overwriting the oldest documents in the collection.</p><p>Djongo lets you define certain Models as 'Capped' Models. The <code>Entry</code> Model is a perfect candidate for being stored as a Capped Model.</p><div appcodecopy class="highlighter-rouge highlight codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Entry</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmbeddedField</span><span class="p">(</span>
        <span class="n">model_container</span><span class="o">=</span><span class="n">Blog</span><span class="p">,</span>
        <span class="n">model_form_class</span><span class="o">=</span><span class="n">BlogForm</span>
    <span class="p">)</span>
    <span class="n">meta_data</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmbeddedField</span><span class="p">(</span>
        <span class="n">model_container</span><span class="o">=</span><span class="n">MetaData</span><span class="p">,</span>
        <span class="n">model_form_class</span><span class="o">=</span><span class="n">MetaDataForm</span>
    <span class="p">)</span>

    <span class="n">headline</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">body_text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>

    <span class="n">authors</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ArrayReferenceField</span><span class="p">(</span>
        <span class="n">to</span><span class="o">=</span><span class="n">Author</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">n_comments</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">capped</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">5242880</span>
        <span class="nb">max</span> <span class="o">=</span> <span class="mi">5000</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">headline</span>
</code></pre><img alt="copy code" src="/assets/images/copy.svg" class="docs-copy"></div><p>As most SQL DBs do not support capped tables, Django lacks a way to define such tables during a migration. Djongo comes with it is own version of <code>manage.py</code> to make this happen. Switch to the root directory of your app and from the command line run:</p><div appcodecopy class="codehilite"><pre><span></span><code>python -m djongo.manage migrate
</code></pre><img alt="copy code" src="/assets/images/copy.svg" class="docs-copy"></div><p>This will result in all Models having <code>capped == True</code> to being recreated as Capped collections.
Use this command only if such a collection doesn't already exists or is empty,
as <code>djongo.manage</code> will drop all collections marked as capped in the model but are
not capped in the DB and create a new empty capped collection.</p></ng-component><!----></div><aside _ngcontent-ng-c2949683947 class="nav-sticky aside-right"><nav _ngcontent-ng-c2949683947 class="nav nav-toc"><h3 _ngcontent-ng-c2949683947><i _ngcontent-ng-c2949683947 class="fas fa-file-alt"></i> On This Page</h3><ul _ngcontent-ng-c2949683947><!----></ul></nav></aside></div></div><div _ngcontent-ng-c3463078263 id="footer" class="page-footer"><footer _ngcontent-ng-c3463078263><aside _ngcontent-ng-c3463078263 class="l-fixed-notice cookie-notice open"><p _ngcontent-ng-c3463078263>We use cookies to enhance user experience. You consent to their usage by browsing this site. <button _ngcontent-ng-c3463078263 id="cookie-accept" class="btn btn-green" jsaction="click:;">Accept</button></p></aside><div _ngcontent-ng-c3463078263 class="page-footer-copyright">© 2025 Doableware AB.</div></footer></div></div></app-body></ng-component><!----></app-root>
<script>
  window.ga = function () {
    ga.q.push(arguments)
  };
  ga.q = [];
  ga.l = +new Date;
  ga('create', 'UA-75159067-1', 'auto');
  ga('set', 'anonymizeIp', false);
  ga('send', 'pageview')
</script>
<script src="https://www.google-analytics.com/analytics.js" async></script>
<link rel="modulepreload" href="chunk-2JPHRIOV.js"><script src="polyfills-EONH2QZO.js" type="module"></script><script src="main-7KEGNSCD.js" type="module"></script>
<script id="ng-state" type="application/json">{"__nghData__":[{"t":{"0":"t1","2":"t2","3":"t3"},"c":{"0":[],"2":[],"3":[]}},{"t":{"6":"t0"},"c":{"6":[]},"d":[9,10,12]},{},{"n":{"1":"0f2nf"},"d":[4,5,7],"c":{"13":[{"i":"c3365394497","r":1}],"21":[]},"t":{"21":"t19"}},{"c":{"0":[{"i":"c2949683947","r":1}]}}]}</script></body></html>